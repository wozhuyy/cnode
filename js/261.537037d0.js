"use strict";(self["webpackChunkvue_cnode"]=self["webpackChunkvue_cnode"]||[]).push([[261],{5261:function(t,s,e){e.r(s),e.d(s,{default:function(){return u}});var n=function(){var t=this,s=t._self._c;return t.topic?s("div",{staticClass:"topic"},[s("base-panel",{scopedSlots:t._u([{key:"panel-content",fn:function(){return[s("div",{staticClass:"topic-head"},[s("div",{staticClass:"head-top"},[t.topic.top||t.topic.good?s("el-tag",{attrs:{type:"success",effect:"dark",size:"mini"}},[t._v(t._s(t.topic.top?"置顶":"精华"))]):t._e(),s("h3",[t._v(t._s(t.topic.title))]),t.accesstoken?s("el-button",{attrs:{type:"success"},on:{click:t.collect}},[t._v(t._s(t.topic.is_collect?"取消收藏":"收藏"))]):t._e()],1),s("p",[s("span",{staticClass:"iconfont icon-dian disc"}),s("span",[t._v("发布于"+t._s(t._f("fromNow")(t.topic.create_at)))]),s("span",{staticClass:"iconfont icon-dian disc"}),s("span",[t._v("作者"+t._s(t.topic.author.loginname))]),s("span",{staticClass:"iconfont icon-dian disc"}),s("span",[t._v(t._s(t.topic.visit_count)+" 次浏览")]),s("span",{staticClass:"iconfont icon-dian disc"}),s("span",[t._v("来自 "+t._s(t._f("tabTextTransform")(t.topic.tab)))])])]),s("div",{staticClass:"topic-content",domProps:{innerHTML:t._s(t.topic.content)}})]},proxy:!0}],null,!1,1908086960)}),t.topic.replies.length?s("base-panel",{scopedSlots:t._u([{key:"panel-head",fn:function(){return[s("div",{staticClass:"comment-head"},[s("span",[s("span",[t._v(t._s(t.topic.replies.length))]),t._v(" 回复")])])]},proxy:!0},{key:"panel-content",fn:function(){return[s("div",{staticClass:"comment-list"},t._l(t.topic.replies,(function(e,n){return s("div",{key:e.id,class:["comment-item",{active:t.commentLikeMost.includes(e.id)}]},[s("img",{attrs:{src:e.author.avatar_url,alt:""}}),s("div",{staticClass:"comment-content"},[s("span",{staticClass:"info"},[s("span",[t._v(" "+t._s(e.author.loginname)+" "+t._s(n+1)+"楼 "),s("span",{staticClass:"iconfont icon-dian disc"}),t._v(" "+t._s(t._f("fromNow")(e.create_at))+" ")]),t.accesstoken||e.ups.length?s("span",{staticClass:"like"},[s("span",{class:["iconfont","icon-dianzan",{up:e.is_uped}],on:{click:function(s){return t.like(e)}}}),e.ups.length?s("span",[t._v(t._s(e.ups.length))]):t._e()]):t._e()]),s("span",{staticClass:"text",domProps:{innerHTML:t._s(e.content)}})])])})),0)]},proxy:!0}],null,!1,392684432)}):t._e(),t.accesstoken?s("BasePanel",{scopedSlots:t._u([{key:"panel-head",fn:function(){return[t._v("添加回复")]},proxy:!0},{key:"panel-content",fn:function(){return[s("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.commentText,expression:"commentText",modifiers:{trim:!0}}],staticClass:"comment-box",domProps:{value:t.commentText},on:{input:function(s){s.target.composing||(t.commentText=s.target.value.trim())},blur:function(s){return t.$forceUpdate()}}}),s("el-button",{attrs:{type:"primary"},on:{click:t.reply}},[t._v("回复")])]},proxy:!0}],null,!1,3508600256)}):t._e()],1):t._e()},c=[],i=(e(7658),e(2223)),o=e(3150),a={components:{BasePanel:i.Z},props:["topicId"],data(){return{topic:null,accesstoken:"",commentText:""}},computed:{commentLikeMost(){if(0===this.topic.replies.length)return[];const t=this.topic.replies.slice(0).sort(((t,s)=>s.ups.length-t.ups.length)),s=[],e=t[0].ups.length;if(e>2){const n=t.filter((t=>t.ups.length===e));n.forEach((t=>{s.push(t.id)}));const c=t[n.length].ups.length;if(c>2){const e=t.filter((t=>t.ups.length===c));e.forEach((t=>{s.push(t.id)}))}}return s}},async created(){const t=sessionStorage.getItem("accesstoken");t&&(this.accesstoken=t);const s=await(0,o.BN)(this.topicId,t||null);console.log(s),this.topic=s.data},methods:{async collect(){const t=this.accesstoken;this.topic.is_collect?((0,o.uk)(this.topic.id,t),this.topic.is_collect=!1):(await(0,o.dA)(this.topic.id,t),this.topic.is_collect=!0)},async like(t){const s=this.accesstoken;if(s){const e=await(0,o.vo)(t.id,s),n=JSON.parse(sessionStorage.getItem("userInfo")).id;"up"===e.action?(t.is_uped=!0,t.ups.push(n)):(t.is_uped=!1,t.ups=t.ups.filter((t=>t!==n)))}},async reply(){const{commentText:t,accesstoken:s,topic:e}=this;if(t){await(0,o.ts)(e.id,s,t);const n=await(0,o.BN)(this.topicId,s);this.topic=n.data,this.commentText=""}}}},p=a,l=e(1001),r=(0,l.Z)(p,n,c,!1,null,null,null),u=r.exports}}]);
//# sourceMappingURL=261.537037d0.js.map