{"version":3,"file":"js/261.537037d0.js","mappings":"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","sources":["webpack://vue-cnode/./src/views/TopicView.vue","webpack://vue-cnode/src/views/TopicView.vue","webpack://vue-cnode/./src/views/TopicView.vue?1b46","webpack://vue-cnode/./src/views/TopicView.vue?4bab"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return (_vm.topic)?_c('div',{staticClass:\"topic\"},[_c('base-panel',{scopedSlots:_vm._u([{key:\"panel-content\",fn:function(){return [_c('div',{staticClass:\"topic-head\"},[_c('div',{staticClass:\"head-top\"},[(_vm.topic.top || _vm.topic.good)?_c('el-tag',{attrs:{\"type\":\"success\",\"effect\":\"dark\",\"size\":\"mini\"}},[_vm._v(_vm._s(_vm.topic.top ? \"置顶\" : \"精华\"))]):_vm._e(),_c('h3',[_vm._v(_vm._s(_vm.topic.title))]),(_vm.accesstoken)?_c('el-button',{attrs:{\"type\":\"success\"},on:{\"click\":_vm.collect}},[_vm._v(_vm._s(_vm.topic.is_collect ? '取消收藏' : '收藏'))]):_vm._e()],1),_c('p',[_c('span',{staticClass:\"iconfont icon-dian disc\"}),_c('span',[_vm._v(\"发布于\"+_vm._s(_vm._f(\"fromNow\")(_vm.topic.create_at)))]),_c('span',{staticClass:\"iconfont icon-dian disc\"}),_c('span',[_vm._v(\"作者\"+_vm._s(_vm.topic.author.loginname))]),_c('span',{staticClass:\"iconfont icon-dian disc\"}),_c('span',[_vm._v(_vm._s(_vm.topic.visit_count)+\" 次浏览\")]),_c('span',{staticClass:\"iconfont icon-dian disc\"}),_c('span',[_vm._v(\"来自 \"+_vm._s(_vm._f(\"tabTextTransform\")(_vm.topic.tab)))])])]),_c('div',{staticClass:\"topic-content\",domProps:{\"innerHTML\":_vm._s(_vm.topic.content)}})]},proxy:true}],null,false,1908086960)}),(_vm.topic.replies.length)?_c('base-panel',{scopedSlots:_vm._u([{key:\"panel-head\",fn:function(){return [_c('div',{staticClass:\"comment-head\"},[_c('span',[_c('span',[_vm._v(_vm._s(_vm.topic.replies.length))]),_vm._v(\" 回复\")])])]},proxy:true},{key:\"panel-content\",fn:function(){return [_c('div',{staticClass:\"comment-list\"},_vm._l((_vm.topic.replies),function(comment,index){return _c('div',{key:comment.id,class:[\n            'comment-item',\n            { active: _vm.commentLikeMost.includes(comment.id) },\n          ]},[_c('img',{attrs:{\"src\":comment.author.avatar_url,\"alt\":\"\"}}),_c('div',{staticClass:\"comment-content\"},[_c('span',{staticClass:\"info\"},[_c('span',[_vm._v(\" \"+_vm._s(comment.author.loginname)+\" \"+_vm._s(index + 1)+\"楼 \"),_c('span',{staticClass:\"iconfont icon-dian disc\"}),_vm._v(\" \"+_vm._s(_vm._f(\"fromNow\")(comment.create_at))+\" \")]),(_vm.accesstoken || comment.ups.length)?_c('span',{staticClass:\"like\"},[_c('span',{class:['iconfont' ,'icon-dianzan',{up:comment.is_uped}],on:{\"click\":function($event){return _vm.like(comment)}}}),(comment.ups.length)?_c('span',[_vm._v(_vm._s(comment.ups.length))]):_vm._e()]):_vm._e()]),_c('span',{staticClass:\"text\",domProps:{\"innerHTML\":_vm._s(comment.content)}})])])}),0)]},proxy:true}],null,false,392684432)}):_vm._e(),(_vm.accesstoken)?_c('BasePanel',{scopedSlots:_vm._u([{key:\"panel-head\",fn:function(){return [_vm._v(\"添加回复\")]},proxy:true},{key:\"panel-content\",fn:function(){return [_c('textarea',{directives:[{name:\"model\",rawName:\"v-model.trim\",value:(_vm.commentText),expression:\"commentText\",modifiers:{\"trim\":true}}],staticClass:\"comment-box\",domProps:{\"value\":(_vm.commentText)},on:{\"input\":function($event){if($event.target.composing)return;_vm.commentText=$event.target.value.trim()},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.reply}},[_vm._v(\"回复\")])]},proxy:true}],null,false,3508600256)}):_vm._e()],1):_vm._e()\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"topic\" v-if=\"topic\">\r\n    <base-panel>\r\n      <template #panel-content>\r\n        <div class=\"topic-head\">\r\n          <div class=\"head-top\">\r\n            <el-tag\r\n              v-if=\"topic.top || topic.good\"\r\n              type=\"success\"\r\n              effect=\"dark\"\r\n              size=\"mini\"\r\n              >{{ topic.top ? \"置顶\" : \"精华\" }}</el-tag\r\n            >\r\n            <h3>{{ topic.title }}</h3>\r\n            <el-button @click=\"collect\" v-if=\"accesstoken\" type='success'>{{topic.is_collect ? '取消收藏' : '收藏'}}</el-button>\r\n          </div>\r\n          <p>\r\n            <span class=\"iconfont icon-dian disc\"></span>\r\n            <span>发布于{{ topic.create_at | fromNow }}</span>\r\n            <span class=\"iconfont icon-dian disc\"></span>\r\n            <span>作者{{ topic.author.loginname }}</span>\r\n            <span class=\"iconfont icon-dian disc\"></span>\r\n            <span>{{ topic.visit_count }} 次浏览</span>\r\n            <span class=\"iconfont icon-dian disc\"></span>\r\n            <span>来自 {{ topic.tab | tabTextTransform }}</span>\r\n          </p>\r\n        </div>\r\n        <div class=\"topic-content\" v-html=\"topic.content\"></div>\r\n      </template>\r\n    </base-panel>\r\n\r\n    <base-panel v-if=\"topic.replies.length\">\r\n      <template #panel-head>\r\n        <div class=\"comment-head\">\r\n          <span\r\n            ><span>{{ topic.replies.length }}</span> 回复</span\r\n          >\r\n        </div>\r\n      </template>\r\n\r\n      <template #panel-content>\r\n        <div class=\"comment-list\">\r\n          <div\r\n            v-for=\"(comment, index) in topic.replies\"\r\n            :key=\"comment.id\"\r\n            :class=\"[\r\n              'comment-item',\r\n              { active: commentLikeMost.includes(comment.id) },\r\n            ]\"\r\n          >\r\n            <img :src=\"comment.author.avatar_url\" alt=\"\" />\r\n            <div class=\"comment-content\">\r\n              <span class=\"info\">\r\n                <span>\r\n                  {{ comment.author.loginname }}\r\n                  {{ index + 1 }}楼\r\n                  <span class=\"iconfont icon-dian disc\"></span>\r\n                  {{ comment.create_at | fromNow }}\r\n                </span>\r\n                <span class=\"like\" v-if=\"accesstoken || comment.ups.length\">\r\n                  <span @click=\"like(comment)\" :class=\"['iconfont' ,'icon-dianzan',{up:comment.is_uped}]\"></span>\r\n                  <span v-if=\"comment.ups.length\">{{ comment.ups.length }}</span>\r\n                </span>\r\n              </span>\r\n              <span class=\"text\" v-html=\"comment.content\"></span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </base-panel>\r\n\r\n    <BasePanel v-if=\"accesstoken\">\r\n    <template #panel-head>添加回复</template>\r\n    <template #panel-content>\r\n      <textarea class=\"comment-box\" v-model.trim=\"commentText\"></textarea>\r\n      <el-button type=\"primary\" @click=\"reply\">回复</el-button>\r\n    </template>\r\n    </BasePanel>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport BasePanel from \"../components/layout/BasePanel.vue\"\r\nimport { getTopic,collected,de_collected,zan,reply } from \"../plugins/api\";\r\n\r\nexport default {\r\n  components:{ BasePanel },\r\n  props: [\"topicId\"],\r\n  data() {\r\n    return {\r\n      topic: null,\r\n      accesstoken:'',\r\n      commentText:''\r\n    };\r\n  },\r\n  computed: {\r\n    // 文章评论数组中点赞前两名的评论\r\n    commentLikeMost() {\r\n      if (this.topic.replies.length === 0) {\r\n        return [];\r\n      }\r\n      const arr = this.topic.replies.slice(0).sort(\r\n        (a, b) => b.ups.length - a.ups.length\r\n      );\r\n      // 存 id 的\r\n      const commentIds = [];\r\n\r\n      const maxOne = arr[0].ups.length;\r\n      if (maxOne > 2) {\r\n        const oneArr = arr.filter((item) => item.ups.length === maxOne);\r\n        oneArr.forEach((comment) => {\r\n          commentIds.push(comment.id);\r\n        });\r\n\r\n        const maxTwo = arr[oneArr.length].ups.length;\r\n        if (maxTwo > 2) {\r\n          const twoArr = arr.filter((item) => item.ups.length === maxTwo);\r\n          twoArr.forEach((comment) => {\r\n            commentIds.push(comment.id);\r\n          });\r\n        }\r\n      }\r\n      return commentIds;\r\n    },\r\n  },\r\n  async created() {\r\n    const accesstoken = sessionStorage.getItem('accesstoken')\r\n    if(accesstoken) {\r\n      this.accesstoken = accesstoken\r\n    }\r\n    const res = await getTopic(this.topicId, accesstoken || null);\r\n    console.log(res);\r\n    this.topic = res.data;\r\n  },\r\n  methods: {\r\n    async collect() {\r\n      const accesstoken = this.accesstoken\r\n      if(this.topic.is_collect){\r\n        // 取消\r\n        de_collected(this.topic.id,accesstoken)\r\n        this.topic.is_collect = false\r\n      }else{\r\n        // 收藏\r\n        await collected(this.topic.id,accesstoken)\r\n        this.topic.is_collect = true\r\n      }\r\n      \r\n\r\n    },\r\n    async like(comment){\r\n      // 不能对自己的评论点赞\r\n      const accesstoken = this.accesstoken\r\n      if(accesstoken){\r\n        const res =  await zan(comment.id,accesstoken)\r\n        const id = JSON.parse(sessionStorage.getItem('userInfo')).id\r\n        if(res.action === 'up'){\r\n          // 点赞成功\r\n          // 修改对应评论的 is_uped 以及 ups\r\n          comment.is_uped = true\r\n          comment.ups.push(id)\r\n        }else{\r\n          // 取消点赞成功\r\n          // 修改对应评论的 is_uped 以及 ups\r\n          comment.is_uped = false\r\n          comment.ups = comment.ups.filter(item => item !== id)\r\n        }\r\n\r\n      }\r\n    },\r\n    async reply(){\r\n      const{commentText ,accesstoken,topic} = this\r\n      if(commentText){\r\n        await reply(topic.id,accesstoken,commentText)\r\n        // 评论的请求成功之后 后端返回的信息太少无法用来更新本地 ，所以 我们重新请求整个文章数据来实现更新\r\n        const res = await getTopic(this.topicId, accesstoken);\r\n        this.topic = res.data;\r\n        this.commentText  = ''\r\n\r\n      }\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang='less'>\r\n.topic {\r\n  width: 1400px;\r\n  margin: 0 auto;\r\n  margin-top: 20px;\r\n  border-radius: 3px;\r\n  overflow: hidden;\r\n  min-height: 140vh;\r\n  .topic-head {\r\n    padding: 20px;\r\n    background-color: #fff;\r\n    border-bottom: 1px solid #ccc;\r\n    .head-top {\r\n      display: flex;\r\n      align-items: center;\r\n      h3 {\r\n        margin-left: 20px;\r\n        font-size: 30px;\r\n      }\r\n    }\r\n    p {\r\n      margin-top: 5px;\r\n      font-size: 12px;\r\n      display: flex;\r\n      align-items: center;\r\n      .disc {\r\n        font-size: 20px;\r\n        margin-top: 1px;\r\n      }\r\n    }\r\n  }\r\n  .topic-content {\r\n    line-height: 1.5;\r\n    \r\n\r\n    background-color: #fff;\r\n    img {\r\n      width: 100%;\r\n    }\r\n  }\r\n  \r\n    \r\n    \r\n    .comment-list {\r\n      .comment-item {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        padding: 10px 10px 20px;\r\n        img {\r\n          width: 40px;\r\n          margin-right: 15px;\r\n          border-radius: 5px;\r\n        }\r\n        .comment-content {\r\n          display: flex;\r\n          flex-grow: 1;\r\n          flex-direction: column;\r\n          .info {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            .up{\r\n            color: blue;\r\n          }\r\n          }\r\n          \r\n        }\r\n      }\r\n      .comment-item.active {\r\n        background-color: rgb(216, 240, 245);\r\n      }\r\n    \r\n  }\r\n  .comment-box{\r\n    width: 100%;\r\n    height: 200px;\r\n  }\r\n}\r\n</style>","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./TopicView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./TopicView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TopicView.vue?vue&type=template&id=0a4b32a6&\"\nimport script from \"./TopicView.vue?vue&type=script&lang=js&\"\nexport * from \"./TopicView.vue?vue&type=script&lang=js&\"\nimport style0 from \"./TopicView.vue?vue&type=style&index=0&id=0a4b32a6&prod&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","topic","staticClass","scopedSlots","_u","key","fn","top","good","attrs","_v","_s","_e","title","accesstoken","on","collect","is_collect","_f","create_at","author","loginname","visit_count","tab","domProps","content","proxy","replies","length","_l","comment","index","id","class","active","commentLikeMost","includes","avatar_url","ups","up","is_uped","$event","like","directives","name","rawName","value","commentText","expression","modifiers","target","composing","trim","$forceUpdate","reply","staticRenderFns","components","BasePanel","props","data","computed","oneArr","commentIds","twoArr","console","methods","de_collected","component"],"sourceRoot":""}